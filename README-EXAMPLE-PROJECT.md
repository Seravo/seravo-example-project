# Seravo example project

Seravo example project goal is to showcase more realistic project using WordPress community tools as much as possible:

- [@wordpress/scripts](https://developer.wordpress.org/block-editor/reference-guides/packages/packages-scripts/) is used for assets bundling.
- [NPM workspaces](https://docs.npmjs.com/cli/v7/using-npm/workspaces) is used for running assets bundling from the root of the project for all assets.
- Example blocks plugin is generated by [@wordpress/create-block](https://developer.wordpress.org/block-editor/reference-guides/packages/packages-create-block/).
- Example theme is modified 2025 theme.

## @wordpress/scripts and NPM workspaces.

[@wordpress/scripts](https://www.npmjs.com/package/@wordpress/scripts) is a collection of reusable scripts tailored for WordPress development powered by Webpack. It's used for assets bundling in your project.

Together with [NPM workspaces](https://docs.npmjs.com/cli/v7/using-npm/workspaces) it can handle all assets bundling from the root of the project.

In the root `package.json` we have defined two workspaces (custom blocks plugin and custom theme):

```json
"workspaces": [
    "htdocs/wp-content/plugins/example-blocks",
    "htdocs/wp-content/themes/example-theme"
]
 ```

 But you can add any number of new workspaces, for example child theme:

 ```json
"workspaces": [
    "htdocs/wp-content/plugins/example-blocks",
    "htdocs/wp-content/themes/example-theme",
    "htdocs/wp-content/themes/example-child-theme"
]
 ```

The idea is that all the workspaces work independently even if they would be moved outside of this project.

### Running NPM commands from the root

By running a command using the `-w` option, it's possible to run the given command in the context of that specific workspace. e.g:

```
npm run build -w=example-blocks
```

This will run the `build` script defined within the `./htdocs/wp-content/plugins/example-blocks/package.json` file.

Note that `name` property in the workspace `package.json` need to match `-w`option.

- For example `example-blocks` is used in 
    - `npm run build -w=example-blocks`
    - `name` property in `./htdocs/wp-content/plugins/example-blocks/package.json` file 
- For example `example-theme` is used in 
    - `npm run build -w=example-theme`
    - `name` property in `./htdocs/wp-content/themes/example-theme/package.json` file
- Follow the same pattern for new workspaces

### `--workspaces` option

It's also possible to use `workspaces` (plural) option to run same NPM script for all workspaces.

For example run `lint:css` in all workspaces:
```
npm run lint:css --workspaces
```

Note that `workspaces` option doesn't seem to work with `start` script. Therefore [npm-run-all](https://www.npmjs.com/package/npm-run-all) package is used for `start` script:

```
run-p start:blocks start:theme
```

## Example blocks plugin assets are handled automatically

When using the same plugin structure as [@wordpress/create-block](https://developer.wordpress.org/block-editor/reference-guides/packages/packages-create-block/) creates, all blocks assets are handled automatically.

- By default assets are gererated in `build` folder
- Blocks `block.json` define the assets and they are also enqueued automatically

## Example theme assets needs `webpack.config.js`

In example theme we need to [configure assets](https://developer.wordpress.org/themes/advanced-topics/build-process/) in `webpack.config.js`.

Basically we are overwriting some  of the `@wordpress/scripts` package configuration with our own:

- Define entry points for your custom CSS and JavaScript files
- Custom rule for handling font files without a hash in the filename.
    - This is not necessary step but can be usefull if you preload font in PHP
    - In other words you will not get random hash in the font file name and you will know the font name to preload
- The webpack-remove-empty-scripts plugin so that there are no leftover `.js` files mapped to your CSS

### Child theme `webpack.config.js`

You can use similar `webpack.config.js` file in your child theme. Main point is to change entry points to your needs.

## How to test

Clone the repo:

```bash
git clone git@github.com:Seravo/seravo-example-project.git
```

Go to project folder:
```bash
cd seravo-example-project
```

Create `.env` file:
```bash
echo "SITE=wordpress" > .env
```

Install composer dependencies:
```bash
composer install
```

Start Docker environment:
```bash
docker-compose up
```

At this point you should have local environment in URL `https://wordpress.local`.

Login to WordPress:
```bash
user:     vagrant
password: vagrant
```

Activate Activate Example theme and Example Blocks plugin.

Install NPM dependencies:
```bash
npm install
```

Test that build process works:
```bash
npm run build
```

Or that build process `start` script works:
```bash
npm run start
```




